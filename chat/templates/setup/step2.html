{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup - Liminal Salt</title>
    <script>
        (function() {
            const theme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
    <link rel="stylesheet" href="{% static 'css/output.css' %}">
</head>
<body class="font-sans bg-surface text-foreground">
    <div class="max-w-xl mx-auto mt-12 p-5">
        <h1 class="text-accent-cyan text-2xl mb-4">ðŸ§‚ Welcome to Liminal Salt</h1>

        <h2 class="text-xl text-foreground mb-2">Step 2: Choose Your Model</h2>
        <p class="text-foreground-secondary text-sm mb-1">Found {{ model_count }} available models</p>
        <p class="text-foreground-secondary text-sm mb-4">ðŸ’¡ Tip: Use Ctrl+F / Cmd+F to search for a specific model</p>

        {% if error %}
        <div class="p-3 px-4 rounded mb-4 bg-danger text-white">{{ error }}</div>
        {% endif %}

        <form method="POST" id="modelForm">
            {% csrf_token %}
            <div class="mb-5">
                <label for="model" class="block mb-2 font-medium">Select a model:</label>
                <select id="model" name="model" required onchange="updateButton()"
                        class="w-full p-3 border border-border rounded bg-surface-secondary text-foreground text-base focus:outline-none focus:border-accent-cyan">
                    <option value="">Choose a model...</option>
                    {% for model_id, display_name in model_options %}
                    <option value="{{ model_id }}" {% if selected_model == model_id %}selected{% endif %}>
                        {{ display_name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div id="selectedInfo" class="p-3 px-4 rounded mb-4 bg-accent text-white hidden">
                <strong>Selected:</strong> <span id="selectedModelText"></span>
            </div>

            <button type="submit" id="submitBtn" disabled
                    class="px-6 py-3 bg-accent text-white rounded font-medium cursor-pointer hover:bg-accent-hover disabled:bg-surface-elevated disabled:cursor-not-allowed">
                Complete Setup
            </button>
        </form>

        <script>
            function updateButton() {
                const select = document.getElementById('model');
                const btn = document.getElementById('submitBtn');
                const info = document.getElementById('selectedInfo');
                const selectedText = document.getElementById('selectedModelText');

                if (select.value) {
                    btn.disabled = false;
                    info.classList.remove('hidden');
                    selectedText.textContent = select.options[select.selectedIndex].text;
                } else {
                    btn.disabled = true;
                    info.classList.add('hidden');
                }
            }

            // Check on page load if there's a selected value
            document.addEventListener('DOMContentLoaded', updateButton);
        </script>
    </div>
</body>
</html>
