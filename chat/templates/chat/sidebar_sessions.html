{% load markdown_extras %}
{% for personality, personality_sessions in grouped_sessions.items %}
    <!-- Using Alpine.js for collapsible groups -->
    <div x-data="{ open: true }">
        <button @click="open = !open" class="personality-header">
            <span x-text="open ? 'â–¼' : 'â–¶'"></span>
            {{ personality|display_name }} ({{ personality_sessions|length }})
        </button>

        <div x-show="open">
            {% for session in personality_sessions %}
                <div class="session-row" data-session-id="{{ session.id }}">
                    <button hx-post="{% url 'switch_session' %}"
                            hx-vals='{"session_id": "{{ session.id }}"}'
                            hx-target="#main-content"
                            hx-swap="innerHTML"
                            onclick="updateSidebarHighlight(this)"
                            data-session-id="{{ session.id }}"
                            class="session-item {% if session.id == current_session %}current{% endif %}">
                        {{ session.title }}
                    </button>
                    <button class="delete-btn"
                            onclick="openDeleteModal('{{ session.id }}', '{{ session.title|escapejs }}')"
                            title="Delete chat">
                        ğŸ—‘ï¸
                    </button>
                </div>
            {% endfor %}
        </div>
    </div>
{% endfor %}
