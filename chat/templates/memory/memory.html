<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Memory - Liminal Salt</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #2E3440;
            color: #ECEFF4;
        }
        h1 {
            color: #88C0D0;
        }
        .subtitle {
            color: #D8DEE9;
            font-size: 14px;
            margin-bottom: 20px;
        }
        .buttons {
            display: flex;
            gap: 12px;
            margin: 20px 0;
        }
        button, .button {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            display: inline-block;
        }
        .button-primary {
            background: #5E81AC;
            color: white;
        }
        .button-primary:hover {
            background: #81A1C1;
        }
        .button-secondary {
            background: #4C566A;
            color: #ECEFF4;
        }
        .button-secondary:hover {
            background: #BF616A;
        }
        .button-back {
            background: #4C566A;
            color: #ECEFF4;
        }
        .button-back:hover {
            background: #5E81AC;
        }
        .alert {
            padding: 12px 16px;
            border-radius: 4px;
            margin: 16px 0;
        }
        .alert-success {
            background: #A3BE8C;
            color: #2E3440;
        }
        .alert-error {
            background: #BF616A;
            color: white;
        }
        .content {
            background: #3B4252;
            padding: 16px;
            border-radius: 8px;
            margin-top: 20px;
            line-height: 1.6;
            border-left: 4px solid #5E81AC;
        }
        .content p {
            margin-bottom: 1em;
        }
        .content p:last-child {
            margin-bottom: 0;
        }
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #D8DEE9;
        }
        .divider {
            height: 1px;
            background: #4C566A;
            margin: 20px 0;
        }
        .input-area {
            background: #3B4252;
            padding: 20px;
            border-top: 1px solid #4C566A;
            margin-top: 20px;
            border-radius: 8px;
        }
        .input-area form {
            display: flex;
            gap: 12px;
        }
        .input-area input {
            flex: 1;
            padding: 12px;
            border: 1px solid #4C566A;
            border-radius: 4px;
            background: #2E3440;
            color: #ECEFF4;
            font-size: 16px;
        }
        .input-area input:focus {
            outline: none;
            border-color: #88C0D0;
        }
        .input-area button {
            padding: 12px 24px;
            background: #5E81AC;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }
        .input-area button:hover {
            background: #81A1C1;
        }
    </style>
</head>
{% load markdown_extras %}
<body>
    <a href="{% url 'chat' %}" class="button button-back">‚Üê Back to Chat</a>

    <h1>üìù User Memory</h1>
    <div class="subtitle">Model: {{ model }}</div>

    {% if success %}
    <div class="alert alert-success">‚úÖ {{ success }}</div>
    {% endif %}

    {% if error %}
    <div class="alert alert-error">‚ö†Ô∏è {{ error }}</div>
    {% endif %}

    <div class="buttons">
        <form method="POST" action="{% url 'update_memory' %}" style="display: inline;">
            {% csrf_token %}
            <button type="submit" class="button-primary">Update User Memory</button>
        </form>

        <form method="POST" action="{% url 'wipe_memory' %}"
              onsubmit="return confirm('Are you sure you want to wipe your entire long-term memory? This action cannot be undone.');"
              style="display: inline;">
            {% csrf_token %}
            <button type="submit" class="button-secondary">Wipe Memory</button>
        </form>
    </div>

    {% if last_update %}
    <div class="subtitle">
        Last updated: <span id="last-update-time" data-timestamp="{{ last_update|date:'U' }}"></span>
    </div>
    <script>
        (function() {
            const el = document.getElementById('last-update-time');
            if (el && el.dataset.timestamp) {
                const date = new Date(parseInt(el.dataset.timestamp) * 1000);
                el.textContent = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) + ' at ' + date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
            }
        })();
    </script>
    {% else %}
    <div class="subtitle">Never updated from all sessions</div>
    {% endif %}

    <div class="divider"></div>

    {% if memory_content %}
    <div class="content">{{ memory_content|markdown }}</div>
    {% else %}
    <div class="content empty-state">
        <strong>No long-term memory found yet.</strong><br>
        Memory will be created after your first update.
    </div>
    {% endif %}

    <!-- Memory Modification Input -->
    <div class="input-area" style="margin-top: 20px;">
        <form method="POST" action="{% url 'modify_memory' %}">
            {% csrf_token %}
            <input type="text"
                   name="command"
                   placeholder="Tell the AI to update your memory..."
                   required
                   autocomplete="off">
            <button type="submit">Update</button>
        </form>
    </div>
</body>
</html>
